/*! Garm Form Validator v1.0.1 | (c) 2014 FAKTOR VIER GmbH | http://faktorvier.ch */
(function($){$.garm={debugMode:!1,setValidator:function(a,b){$.garm.validators[a]=b},setConfig:function(a,b){$.garm.config[a]=b},info:function(a){$.garm.debugMode&&console.info("GARM: "+a)},warn:function(a){$.garm.debugMode&&console.warn("GARM: "+a)}};
$.garm.validators={email:/^((([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))|\s*)$/,url:/^((https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*))|\s*)$/,integer:/^((\-?[0-9]+)|\s*)$/,decimal:/^((\-?\d+\.\d{1,})|\s*)$/,alpha:/^(([a-z]+)|\s*)$/i,alphanumeric:/^(([a-z0-9]+)|\s*)$/i,password:/^(((?=.{8,})(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9])(?=.*[!@#$&\*]).*)|\s*)$/,
required:function(a,b,c){var d=!0;a[0]=a[0]||1;a[1]=a[1]||-1;"select"==c[0].tagName.toLowerCase()&&c.prop("multiple")?(b=c.find("option:selected").length,d&&0!==a[0]&&(d=b>=+a[0]),d&&-1!==a[1]&&(d=b<=+a[1])):d="checkbox"==c.attr("type")?c.is(":checked"):/^\s*\S.*$/m.test(b);return d},creditcard:function(a,b){b="undefined"!=typeof a[0]&&"strict"==a[0]?b:b.replace(/[\s\-]*/g,"");return/^(((?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|6(?:011|5[0-9]{2})[0-9]{12}|(?:2131|1800|35\d{3})\d{11})[\s]{0,4})|\s*)$/.test(b)},
number:function(a,b){b=$.trim(b);var c=!isNaN(b)||""==b;a[0]=a[0]||"n";a[1]=a[1]||"n";c&&""!=b&&!isNaN(a[0])&&(c=+b>=+a[0]);c&&""!=b&&!isNaN(a[1])&&(c=+b<=+a[1]);return c},length:function(a,b){b=$.trim(b);var c=!0;a[0]=a[0]||0;a[1]=a[1]||-1;c&&""!=b&&0!==a[0]&&(c=b.length>=+a[0]);c&&""!=b&&-1!==a[1]&&(c=b.length<=+a[1]);return c},match:function(a,b){return-1!=$.map(a,function(a){return a.toLowerCase()}).indexOf(b.toLowerCase())||""==b},"match-case":function(a,b){return-1!=a.indexOf(b)||""==b},"match-field":function(a,
b){var c=!0;$(a.join(",")).each(function(){if($(this).val()!=b)return c=!1});return c},date:function(a,b){a[0]=a[0]||"d.m.y";var c=a[0].substr(1,1),d=a[0].split(c),c=b.split(c);return""==$.trim(b)||d.length==c.length&&!isNaN(Date.parse(c[d.indexOf("m")]+"."+c[d.indexOf("d")]+"."+c[d.indexOf("y")]))},checkboxgroup:function(a,b,c){a[0]=a[0]||0;a[1]=a[1]||-1;b=c.find('input[type="checkbox"]:checked').length;(c=b>=+a[0])&&-1!==a[1]&&(c=b<=+a[1]);return c}};
$.garm.config={classFormBusy:"busy",classFieldError:"error",classFieldLoading:"loading",classLabelError:"",attr:"data-garm",attrIgnore:"data-garm-ignore",onlyValidate:!1,beforeSubmit:function(){},onSubmit:function(){},onSuccess:function(){},onFail:function(){}};
$.garm.validate=function(a,b,c){a.beforeSubmit();if(c.hasClass(a.classFormBusy))return $.garm.info("VALIDATION ALREADY BUSY"),!1;$.garm.info("VALIDATION STARTED");var d=c.find("["+a.attr+"]").not("["+a.attr+'=""]'),h=c.find("label"),l=0,p=[];d.removeClass(a.classFieldError);h.removeClass(a.classLabelError);c.addClass(a.classFormBusy);d.each(function(){var d=$(this),h=d.val(),g=d.attr("name"),q=d.attr(a.attr).split(" "),r;for(r in q){var e=q[r],s=[];-1!==e.indexOf("[")&&(s=e.substring(e.indexOf("[")+
1,e.length-1).split(","),e=e.substring(0,e.indexOf("[")));var m=d.is("["+a.attrIgnore+'~="'+e+'"]')||d.is("["+a.attrIgnore+'="all"]'),n=d.parents("["+a.attrIgnore+"]");n.length&&(m=n.is("["+a.attrIgnore+'~="'+e+'"]')||n.is("["+a.attrIgnore+'="all"]'));m&&$.garm.info("validation ignored (field: "+g+", validator: "+e+")");if(e in b&&!d.hasClass(a.classFieldError)&&!m){var f=b[e];p.push(function(){var b=$.Deferred();if("function"==typeof f){var k=f(s,h,d,c,b);"undefined"==typeof k||"undefined"==typeof k.promise?
b.resolve(1==k):(b=k,d.addClass(a.classFieldLoading))}else"string"==typeof f&&0===f.indexOf("http")?(d.addClass(a.classFieldLoading),$.get(f,{value:h}).always(function(a){b.resolve(1==$.trim(a))})):f instanceof RegExp&&b.resolve(f.test(h));b.always(function(b){d.removeClass(a.classFieldLoading);0==b&&(l++,d.addClass(a.classFieldError),c.find('label[for="'+d.attr("id")+'"]').addClass(a.classLabelError),$.garm.debugMode&&("undefined"==typeof g&&(g=d[0].tagName.toLowerCase(),g+=d.is("[id]")?"#"+d.attr("id"):
""),$.garm.warn("validation failed (field: "+g+", validator: "+e+")")))});return b.promise()}())}}});$.when.apply($,p).done(function(){a.onSubmit();if(0===l){$.garm.info("VALIDATION ENDED: SUCCESS");if("undefined"!=typeof a.onSuccess())return!0;a.onlyValidate?c.removeClass(a.classFormBusy):c.off("submit.garm").submit()}else if(c.removeClass(a.classFormBusy),$.garm.warn("VALIDATION ENDED: "+l+" FIELDS FAILED"),"undefined"!=typeof a.onFail())return!0});return!0};
$.fn.garm=function(a,b){var c=$.extend($.extend({},$.garm.config),a),d=$.extend($.extend({},$.garm.validators),b);return this.each(function(){if(c.onlyValidate)$(this).each(function(){$.garm.validate(c,d,$(this))});else $(this).on("submit.garm",function(a){a.preventDefault();$.garm.validate(c,d,$(this))})})};}(jQuery));